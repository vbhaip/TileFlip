(this["webpackJsonpsimulation-generation"]=this["webpackJsonpsimulation-generation"]||[]).push([[0],{165:function(t,e,a){},166:function(t,e,a){},698:function(t,e,a){"use strict";a.r(e);var i=a(2),n=a(0),r=a.n(n),s=a(32),o=a.n(s),h=(a(165),function(t){t&&t instanceof Function&&a.e(3).then(a.bind(null,717)).then((function(e){var a=e.getCLS,i=e.getFID,n=e.getFCP,r=e.getLCP,s=e.getTTFB;a(t),i(t),n(t),r(t),s(t)}))}),c=a(24),l=a(25),u=a(28),d=a(26),p=a(4),g=(a(166),a(714)),f=a(715),m=a(88),b=a(126),y=a(37),j=a(90),x=a.n(j),v=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t){var i;return Object(c.a)(this,a),(i=e.call(this,t)).state={data:[],interval:null,ready:!1,existingBlobs:[],time:0},i.updateVis=i.updateVis.bind(Object(p.a)(i)),i.computeNextState=i.computeNextState.bind(Object(p.a)(i)),i.computeVal=i.computeVal.bind(Object(p.a)(i)),i.computeNeighbors=i.computeNeighbors.bind(Object(p.a)(i)),i.mod=i.mod.bind(Object(p.a)(i)),i.floatToGrayscale=i.floatToGrayscale.bind(Object(p.a)(i)),i.floatToHSL=i.floatToHSL.bind(Object(p.a)(i)),i.refresh=i.refresh.bind(Object(p.a)(i)),i.setup=i.setup.bind(Object(p.a)(i)),i.drawChart=i.drawChart.bind(Object(p.a)(i)),i.flipItem=i.flipItem.bind(Object(p.a)(i)),i.setup(),i.refresh(),i.gif=new x.a({workers:3,quality:1,repeat:0,workerScript:"/simulation-generation/gif.worker.js",debug:!0}),i.addGifItem=i.addGifItem.bind(Object(p.a)(i)),i}return Object(l.a)(a,[{key:"setup",value:function(){var t=[];this.edgeLength=this.props.edgeLength,this.size=this.props.size;for(var e=0;e<Math.pow(this.edgeLength,2);e++)t.push({index:e,x:e%this.edgeLength,y:Math.floor(e/this.edgeLength),state:0,color:"",animate:!1});return this.setState({data:t}),this.margin={top:.1*this.edgeLength,bottom:.1*this.edgeLength,left:.1*this.edgeLength,right:.1*this.edgeLength},this.xScale=y.b().domain([0,this.edgeLength]).range([this.margin.left,this.size-this.margin.right]),this.yScale=y.b().domain([0,this.edgeLength]).range([this.margin.top,this.size-this.margin.bottom]),this.squareLength=this.size/this.edgeLength,console.log(this.props.initdata),Object.entries(this.props.initdata).forEach((function(e){var a=Object(b.a)(e,2),i=a[0],n=a[1];try{t[parseInt(i)].state=parseFloat(n)}catch(r){console.log(r)}})),t}},{key:"updateVis",value:function(){var t=this;this.viscontainer.selectAll(".main-rect").data(this.state.data).filter((function(t,e){return t.animate})).transition().duration((function(e,a){return t.props.refreshRate})).ease(y.a).attr("fill",(function(t,e){return""===t.color?"black":t.color})).attr("fill-opacity",(function(t,e){return t.state})),this.viscontainer.selectAll(".main-rect").data(this.state.data).filter((function(t,e){return!t.animate})).attr("fill",(function(t,e){return""===t.color?"black":t.color})).attr("fill-opacity",(function(t,e){return t.state}))}},{key:"updateVisDiscreteFlip",value:function(){this.viscontainer.selectAll(".main-rect").data(this.state.data).attr("fill",(function(t,e){return""===t.color?"black":t.color})).attr("fill-opacity",(function(t,e){return t.state}))}},{key:"computeVal",value:function(t){return t<0||t>=Math.pow(this.edgeLength,2)?-1:this.state.data[t].state}},{key:"mod",value:function(t,e){return(t%e+e)%e}},{key:"computeNeighbors",value:function(t){var e=this.computeVal(this.mod(t-this.edgeLength,Math.pow(this.edgeLength,2))),a=this.computeVal(this.mod(t+this.edgeLength,Math.pow(this.edgeLength,2))),i=t%this.edgeLength===0?t+this.edgeLength-1:t-1,n=this.computeVal(i),r=(t+1)%this.edgeLength===0?t-this.edgeLength+1:t+1,s=this.computeVal(r),o=this.computeVal(this.mod(i-this.edgeLength,Math.pow(this.edgeLength,2))),h=this.computeVal(this.mod(i+this.edgeLength,Math.pow(this.edgeLength,2)));return[o,e,this.computeVal(this.mod(r-this.edgeLength,Math.pow(this.edgeLength,2))),s,this.computeVal(this.mod(r+this.edgeLength,Math.pow(this.edgeLength,2))),a,h,n]}},{key:"floatToGrayscale",value:function(t){return"#"+("0"+Number(parseInt(255*(1-t),10)).toString(16)).slice(-2).repeat(3)}},{key:"floatToHSL",value:function(t){return"hsl("+Math.round(t%1*360)+", 100%, 50%)"}},{key:"computeNextState",value:function(){var t=this;this.setState((function(e){return{data:e.data.map((function(a,i){var n=Object(m.a)({},a),r=t.computeNeighbors(i),s={};s.upleft=r[0],s.up=r[1],s.upright=r[2],s.right=r[3],s.downright=r[4],s.down=r[5],s.downleft=r[6],s.left=r[7],s.neighbors=r,s.board=e.data.map((function(t){return t.state})),s.curr=a.state,s.ones=r.filter((function(t){return 1===t})).length,s.zeroes=r.filter((function(t){return 0===t})).length,s.corners=r.filter((function(t,e){return 1===t&&e%2===0})).length,s.sides=r.filter((function(t,e){return 1===t&&e%2===1})).length,s.index=i,s.x=a.x,s.y=a.y,s.color=n.color,s.float_to_color=t.floatToHSL,s.resolution=t.props.edgeLength,s.t=e.time;var o=t.props.rule(s);return"number"!==typeof o||isNaN(o)?n.state=s.curr:n.state=o,"boolean"===typeof o&&(n.state=o?1:0),""!==s.color?n.color=s.color:n.color="",!0===s.animate?n.animate=!0:n.animate=!1,n})),time:e.time+1}}))}},{key:"flipItem",value:function(t){this.setState((function(e){return{data:e.data.map((function(e,a){if(a===t.index){var i=Object(m.a)({},e);return i.state<.5?i.state=1:i.state=0,i}return e}))}})),this.updateVisDiscreteFlip()}},{key:"drawChart",value:function(){var t=this;this.data=this.setup(),this.svg=y.c("#"+this.props.id).attr("width",this.size+this.margin.left+this.margin.right).attr("height",this.size+this.margin.top+this.margin.bottom),this.svg.selectAll("g").remove(),this.svg.selectAll("rect").remove(),this.viscontainer=this.svg.append("g");var e=this;this.viscontainer.append("g").selectAll(".background-rect").data(this.data).enter().append("rect").attr("class","background-rect").attr("fill",(function(t,e){return"white"})).attr("stroke-width",2).attr("stroke","black").attr("x",(function(e,a){return t.xScale(e.x)})).attr("y",(function(e,a){return t.yScale(e.y)})).attr("rx",(function(e,a){return.2*t.squareLength})).attr("ry",(function(e,a){return.2*t.squareLength})).attr("width",this.squareLength).attr("height",this.squareLength),this.viscontainer.append("g").selectAll(".main-rect").data(this.data).enter().append("rect").attr("class","main-rect").attr("id",(function(t,e){return t.index})).attr("fill",(function(t,e){return""===t.color?"black":t.color})).attr("fill-opacity",(function(t,e){return t.state})).attr("stroke-width",2).attr("stroke","black").attr("x",(function(e,a){return t.xScale(e.x)})).attr("y",(function(e,a){return t.yScale(e.y)})).attr("rx",(function(e,a){return.2*t.squareLength})).attr("ry",(function(e,a){return.2*t.squareLength})).attr("width",this.squareLength).attr("height",this.squareLength),this.props.isMobile?this.viscontainer.selectAll(".main-rect").on("touchstart",(function(t,a){e.isDown=!0,e.flipItem(a)})).on("touchend",(function(t,a){e.isDown=!1})):this.viscontainer.selectAll(".main-rect").on("mousedown",(function(t,a){e.isDown=!0,e.flipItem(a)})).on("mouseup",(function(t,a){e.isDown=!1})).on("mouseover",(function(t,a){e.isDown&&e.flipItem(a)})),y.c("body").on("mouseup",(function(t,a){e.isDown=!1})),this.setState({ready:!0})}},{key:"componentDidMount",value:function(){this.drawChart()}},{key:"refresh",value:function(){this.props.play&&this.state.ready&&(this.addGifItem(),this.computeNextState(),this.updateVis()),setTimeout(this.refresh,this.props.refreshRate)}},{key:"componentDidUpdate",value:function(t){if(this.props.edgeLength!==t.edgeLength&&this.drawChart(),this.props.play!==t.play&&this.props.play){for(var e={},a=0;a<this.state.data.length;a++)0!==this.state.data[a].state&&(e[a]=this.state.data[a].state.toFixed(2));this.props.setExportInitData(JSON.stringify(e)),this.gif=new x.a({workers:3,quality:1,repeat:0,workerScript:"/simulation-generation/gif.worker.js",debug:!0}),this.state.existingBlobs.map((function(t){URL.revokeObjectURL(t)})),this.setState({existingBlobs:[],time:0}),this.props.setGifURL("")}if(this.props.play!==t.play&&!this.props.play&&this.gif.frames.length>0){this.gif.render();var i=this;this.gif.on("finished",(function(t){var e=URL.createObjectURL(t,{type:"image/gif"});i.setState((function(t){return{existingBlobs:t.existingBlobs.concat(e)}})),i.props.setGifURL(e)}))}}},{key:"addGifItem",value:function(){if(!(this.state.existingBlobs.length>50)){var t=new Image,e=(new XMLSerializer).serializeToString(this.svg.node()),a=new Blob([e],{type:"image/svg+xml"}),i=URL.createObjectURL(a);this.setState((function(t){return{existingBlobs:t.existingBlobs.concat(i)}}));var n=this;t.onload=function(){n.gif.addFrame(t,{delay:n.props.refreshRate,copy:!0})},t.src=i}}},{key:"render",value:function(){return Object(i.jsx)("svg",{id:this.props.id},this.props.edgeLength)}}]),a}(r.a.Component),w=a(716),O=a(48),L=a(121),S=a.n(L),R=(a(176),a(177),a(178),a(49)),k=a.n(R),F=a(50),C=a.n(F),I=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t){var i;if(Object(c.a)(this,a),(i=e.call(this,t)).handleRuleChange=i.handleRuleChange.bind(Object(p.a)(i)),i.handleRuleChangeAce=i.handleRuleChangeAce.bind(Object(p.a)(i)),i.updateResolution=i.updateResolution.bind(Object(p.a)(i)),i.handlePlayChange=i.handlePlayChange.bind(Object(p.a)(i)),i.setExportInitData=i.setExportInitData.bind(Object(p.a)(i)),i.shareURL=i.shareURL.bind(Object(p.a)(i)),i.setGifURL=i.setGifURL.bind(Object(p.a)(i)),i.updateRefresh=i.updateRefresh.bind(Object(p.a)(i)),i.setStateFromQuery=i.setStateFromQuery.bind(Object(p.a)(i)),i.progressExample=i.progressExample.bind(Object(p.a)(i)),i.rawquery=window.location.search.slice(1),""===i.rawquery&&window.location.hash.includes("?")&&(i.rawquery=window.location.hash,i.rawquery=i.rawquery.slice(i.rawquery.indexOf("?")+1)),console.log(i.rawquery),i.query=k.a.parse(i.rawquery),fetch("/simulation-generation/examples.txt").then((function(t){return t.text()})).then((function(t){if(i.examples=t.split("\n\n"),i.examples=i.examples.map((function(t){return t.slice(t.indexOf(":")+1)})),console.log(i.examples),i.curr_example=0,0===Object.keys(i.query).length){var e=k.a.parse(i.examples[i.curr_example]);i.setStateFromQuery(e)}i.setState({curr_example:0,examples:i.examples})})),i.refreshRate=1e3,i.edgeLength=10,i.editor_val="function rule(ctx){\n\n        }",i.play=!1,i.initdata=[],"refreshRate"in i.query&&(i.refreshRate=parseInt(i.query.refreshRate)),"resolution"in i.query&&(i.edgeLength=parseInt(i.query.resolution)),"code"in i.query&&(i.editor_val=C.a.decode(i.query.code)),"play"in i.query&&"true"===i.query.play&&(i.play=!0),"state"in i.query)try{i.initdata=JSON.parse(i.query.state)}catch(n){console.log(n)}return i.initrule=i.getFunctionFromString(i.editor_val),i.state={rule:i.initrule,edgeLength:i.edgeLength,play:i.play,editor_val:i.editor_val,refreshRate:i.refreshRate,exportInitData:"",gifURL:""},i.state.initdata=i.initdata,O.isMobile?(i.viswidth=.65*window.innerWidth,i.editorwidth=.7*window.innerWidth,i.fontSize=10):(i.viswidth=.4*window.innerHeight,i.editorwidth=.4*window.innerWidth,i.fontSize=14),i}return Object(l.a)(a,[{key:"setStateFromQuery",value:function(t){if(console.log(t),"refreshRate"in t&&this.setState({refreshRate:parseInt(t.refreshRate)}),"resolution"in t&&this.setState({edgeLength:parseInt(t.resolution)}),"code"in t){var e=C.a.decode(t.code);this.setState({editor_val:e}),this.setState({rule:this.getFunctionFromString(e)})}if("play"in t&&"true"===t.play&&this.setState({play:!0}),"state"in t&&t.state.length>0)try{this.setState({initdata:JSON.parse(t.state)})}catch(i){console.log(i)}else{this.initdata={};for(var a=0;a<Math.pow(this.edgeLength,2);a++)this.initdata[a]=0;this.setState({initdata:this.initdata})}}},{key:"progressExample",value:function(){var t=this;this.setState((function(e){var a=(e.curr_example+1)%e.examples.length;return t.setStateFromQuery(k.a.parse(e.examples[a])),{curr_example:a}}))}},{key:"setExportInitData",value:function(t){this.setState({exportInitData:t})}},{key:"updateRefresh",value:function(t,e){console.log(e),this.setState({refreshRate:e})}},{key:"getFunctionFromString",value:function(t){try{return new Function("x","\n        try{\n          // ".concat(t.replace(/\n/g,""),";\n          let f = ").concat(t,"\n\n          return f(x);\n        }\n        catch(error){\n          return error;\n        }\n        "))}catch(e){console.log(e)}return this.state?new Function("x","return null;"):this.state.rule}},{key:"handleRuleChange",value:function(t){console.log(t);try{var e=new Function("ctx","\n        try{\n          ".concat(t.target.value.replace(/\n/g,""),";\n        }\n        catch(error){\n          return error;\n        }\n        "));this.setState({rule:e}),console.log(e)}catch(a){console.log(a)}}},{key:"handleRuleChangeAce",value:function(t){this.setState({editor_val:t}),console.log(t),console.log(C.a.encode(t));var e=this.getFunctionFromString(t);this.setState({rule:e})}},{key:"updateResolution",value:function(t,e){this.setState({edgeLength:e,initdata:[]})}},{key:"handlePlayChange",value:function(t){this.setState((function(t){return{play:!t.play}}))}},{key:"shareURL",value:function(){var t={};t.refreshRate=this.state.refreshRate,t.play=!0,t.resolution=this.state.edgeLength,t.code=C.a.encode(this.state.editor_val),t.state=this.state.exportInitData;var e=k.a.stringify(t),a=window.location.toString(),i=(a=a.slice(0,a.lastIndexOf("/")))+"?"+e;console.log(i),window.history.pushState("","",i),window.prompt("Copy to share (Ctrl+C, Enter)",i)}},{key:"setGifURL",value:function(t){this.setState({gifURL:t})}},{key:"render",value:function(){return Object(i.jsxs)("div",{className:"App",children:[Object(i.jsxs)("div",{id:"vis-container",children:[Object(i.jsx)(v,{id:"viz",edgeLength:this.state.edgeLength,size:this.viswidth,rule:this.state.rule,play:this.state.play,refreshRate:this.state.refreshRate,initdata:this.state.initdata,setExportInitData:this.setExportInitData,setGifURL:this.setGifURL,isMobile:O.isMobile}),Object(i.jsx)("p",{style:{color:this.props.theme.palette.lightText.main,fontFamily:this.props.theme.typography.fontFamily},children:"Refresh Rate (ms)"}),Object(i.jsx)(f.a,{defaultValue:this.refreshRate,valueLabelDisplay:"auto",step:100,marks:!0,min:200,max:2e3,value:this.state.refreshRate,style:{width:"50%"},onChange:this.updateRefresh}),Object(i.jsx)("p",{style:{color:this.props.theme.palette.lightText.main,fontFamily:this.props.theme.typography.fontFamily},children:"Resolution"}),Object(i.jsx)(f.a,{defaultValue:this.edgeLength,valueLabelDisplay:"auto",step:1,marks:!0,min:4,max:15,value:this.state.edgeLength,onChange:this.updateResolution,style:{width:"50%"}}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)(g.a,{variant:"contained",color:"primary",onClick:this.handlePlayChange,children:this.state.play?"Pause":"Play"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)(g.a,{variant:"contained",color:"primary",onClick:this.shareURL,children:"Share URL"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)("a",{target:"_blank",href:""!==this.state.gifURL&&this.state.gifURL,download:"evolution.gif",style:{color:"inherit","text-decoration":"none"},children:Object(i.jsx)(g.a,{variant:"contained",color:"primary",download:this.state.gifURL,disabled:""===this.state.gifURL,target:"_blank",children:""!==this.state.gifURL?"Download as GIF":"GIF not ready"})})]}),Object(i.jsxs)("div",{id:"controls-container",children:[Object(i.jsx)(S.a,{mode:"javascript",theme:"monokai",name:"editor",onChange:this.handleRuleChangeAce,fontSize:this.fontSize,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,value:this.state.editor_val,height:.5*window.innerHeight,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!O.isMobile,showGutter:!O.isMobile,tabSize:2},width:this.editorwidth+"px"}),Object(i.jsx)(g.a,{variant:"contained",color:"primary",onClick:this.progressExample,children:"Next Example"}),Object(i.jsx)("br",{}),Object(i.jsx)("br",{}),Object(i.jsx)(g.a,{variant:"contained",color:"secondary",href:"#help",children:"Help/More Info"})]})]})}}]),a}(r.a.Component),q=Object(w.a)(I),U=a(122),D=a.n(U),M=a(123),A=a.n(M),V=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(t){var i;return Object(c.a)(this,a),(i=e.call(this,t)).state={text:""},fetch("/simulation-generation/info.md").then((function(t){return t.text()})).then((function(t){i.setState({text:t})})),i}return Object(l.a)(a,[{key:"render",value:function(){return Object(i.jsxs)("div",{style:{marginLeft:"20vw",marginRight:"20vw",color:"white"},children:[Object(i.jsx)(D.a,{plugins:[A.a],children:this.state.text}),Object(i.jsx)("div",{style:{textAlign:"center"},children:Object(i.jsx)(g.a,{variant:"contained",color:"primary",href:"#",children:"Back"})})]})}}]),a}(r.a.Component),G=a(125),_=a(713),z=a(124),N=a(5),B=Object(G.a)({palette:{primary:{main:"#9B6A6C"},secondary:{main:"#6DC0D5"},error:{main:"#c1666b"},warning:{main:"#d4b843"},black:{main:"#020202"},lightText:{main:"#F7F0F5"}},typography:{fontFamily:"'Oswald'"}}),E=function(t){Object(u.a)(a,t);var e=Object(d.a)(a);function a(){return Object(c.a)(this,a),e.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return Object(i.jsx)(z.a,{children:Object(i.jsxs)(N.c,{children:[Object(i.jsx)(N.a,{exact:!0,path:"/",children:Object(i.jsx)(_.a,{theme:B,children:Object(i.jsx)(q,{})})}),Object(i.jsx)(N.a,{exact:!0,path:"/help",children:Object(i.jsx)(_.a,{theme:B,children:Object(i.jsx)(V,{})})})]})})}}]),a}(r.a.Component),T=Object(w.a)(E);o.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsx)(T,{})}),document.getElementById("root")),h()}},[[698,1,2]]]);
//# sourceMappingURL=main.b7d27570.chunk.js.map